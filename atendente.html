<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Painel Atendente</title>
<style>
.pref-badge {
    background: #fee2e2;
    color: #b91c1c;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 800;
}
</style>
</head>
<body>

<div id="lista"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, onSnapshot, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
    apiKey: "AIzaSyCMwHzsfQZIHsEqKlkIpQNTbZxCVYhFoZ8",
    projectId: "fila-cord"
});
const db = getFirestore(app);

onSnapshot(collection(db,"fila"), snap => {
    lista.innerHTML = snap.docs.map(d => {
        const a = d.data();
        return `
            <div>
                <h3>${a.nome}
                ${a.preferencial === "SIM" ? '<span class="pref-badge">PREFERENCIAL</span>' : ''}
                </h3>
                <p>${a.curso}</p>
                <strong>${a.senha}</strong>
                <button onclick="chamar('${d.id}','${a.nome}','${a.curso}')">CHAMAR</button>
            </div>
        `;
    }).join("");
});

window.chamar = async (id,nome,curso) => {
    await updateDoc(doc(db,"fila",id), { status:"CHAMANDO" });
    const msg = new SpeechSynthesisUtterance(`Pr√≥ximo atendimento ${nome}, curso ${curso}`);
    speechSynthesis.speak(msg);
};
</script>
</body>
</html>
