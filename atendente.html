<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Fila</title>
    <style>
        :root { --primary: #2563eb; --success: #22c55e; --danger: #ef4444; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: #f1f5f9; color: #334155; }
        header { background: white; padding: 1rem 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .stat-card h3 { margin: 0; font-size: 0.8rem; text-transform: uppercase; color: #64748b; }
        .stat-card div { font-size: 1.5rem; font-weight: bold; }

        .fila-grid { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .fila-header { background: #f8fafc; padding: 1rem; display: grid; grid-template-columns: 100px 1fr 1fr 200px; font-weight: bold; border-bottom: 1px solid #e2e8f0; }
        .fila-row { padding: 1rem; display: grid; grid-template-columns: 100px 1fr 1fr 200px; align-items: center; border-bottom: 1px solid #f1f5f9; transition: background 0.2s; }
        .fila-row:hover { background: #f8fafc; }
        .fila-row.chamando { background: #f0fdf4; border-left: 4px solid var(--success); }

        .badge { padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; }
        .badge-espera { background: #fff7ed; color: #9a3412; }
        .badge-chamando { background: #dcfce7; color: #166534; }

        .btn { padding: 8px 16px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-call { background: var(--primary); color: white; margin-right: 5px; }
        .btn-done { background: #e2e8f0; color: #475569; }
        .btn:hover { opacity: 0.8; }
    </style>
</head>
<body>
    <header>
        <h2 style="margin:0; color:var(--primary)">üìç Fila Cord Admin</h2>
        <div id="clock" style="font-weight: 500;"></div>
    </header>

    <div class="container">
        <div class="stats">
            <div class="stat-card"><h3>Aguardando</h3><div id="count-total">0</div></div>
            <div class="stat-card" style="border-color: var(--success)"><h3>√öltima Chamada</h3><div id="last-called">--</div></div>
        </div>

        <div class="fila-grid">
            <div class="fila-header">
                <div>SENHA</div><div>ALUNO / CURSO</div><div>MATR√çCULA</div><div>A√á√ïES</div>
            </div>
            <div id="corpo-fila">
                </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, orderBy, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCMwHzsfQZIHsEqKlkIpQNTbZxCVYhFoZ8",
            authDomain: "fila-cord.firebaseapp.com",
            projectId: "fila-cord",
            storageBucket: "fila-cord.firebasestorage.app",
            messagingSenderId: "249621709749",
            appId: "1:249621709749:web:18b6486f2095f95f29cffc"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const q = query(collection(db, "fila"), orderBy("hora", "asc"));
        
        onSnapshot(q, (snapshot) => {
            const corpo = document.getElementById("corpo-fila");
            document.getElementById("count-total").innerText = snapshot.size;
            corpo.innerHTML = ""; 

            snapshot.forEach((docSnap) => {
                const item = docSnap.data();
                const id = docSnap.id;
                const isChamando = item.status === 'CHAMANDO';

                if(isChamando) document.getElementById("last-called").innerText = item.senha;

                const row = document.createElement("div");
                row.className = `fila-row ${isChamando ? 'chamando' : ''}`;
                row.innerHTML = `
                    <div style="font-weight:bold; font-size:1.2rem">${item.senha}</div>
                    <div>
                        <div style="font-weight:600">${item.nome}</div>
                        <div style="font-size:0.8rem; color:#64748b">${item.curso}</div>
                    </div>
                    <div style="color:#64748b">${item.matricula}</div>
                    <div>
                        <button class="btn btn-call" onclick="window.chamar('${id}', '${item.nome}')">CHAMAR</button>
                        <button class="btn btn-done" onclick="window.finalizar('${id}')">OK</button>
                    </div>
                `;
                corpo.appendChild(row);
            });
        });

        window.chamar = async (id, nome) => {
            await updateDoc(doc(db, "fila", id), { status: 'CHAMANDO' });
            // S√≠ntese de voz opcional:
            const msg = new SpeechSynthesisUtterance("Pr√≥ximo aluno: " + nome);
            window.speechSynthesis.speak(msg);
        };

        window.finalizar = async (id) => {
            await deleteDoc(doc(db, "fila", id));
        };

        // Rel√≥gio simples
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }, 1000);
    </script>
</body>
</html>
