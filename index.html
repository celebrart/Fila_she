<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü©∫ Gerador de Senha - Atendimento Aluno</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #0f172a;
        }

        .container {
            width: 100%;
            max-width: 420px;
            background: rgba(15, 23, 42, 0.92);
            border-radius: 18px;
            padding: 24px 20px 20px;
            box-shadow:
                0 18px 40px rgba(15, 23, 42, 0.45),
                0 0 0 1px rgba(148, 163, 184, 0.25);
            color: #e5e7eb;
            position: relative;
            overflow: hidden;
            animation: cardEnter 0.6s ease-out;
        }

        /* brilho suave no topo */
        .container::before {
            content: '';
            position: absolute;
            inset: -40%;
            background:
                radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.12), transparent 55%),
                radial-gradient(circle at 100% 0%, rgba(129, 140, 248, 0.16), transparent 55%);
            opacity: 0.9;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes cardEnter {
            from {
                opacity: 0;
                transform: translateY(18px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 14px;
        }

        .header-icon {
            width: 40px;
            height: 40px;
            border-radius: 14px;
            background: radial-gradient(circle at 0 0, #22c55e, #16a34a);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.55);
            animation: pulseIcon 2.4s ease-in-out infinite;
        }

        @keyframes pulseIcon {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 10px 25px rgba(16, 185, 129, 0.55);
            }
            50% {
                transform: scale(1.06);
                box-shadow: 0 18px 32px rgba(16, 185, 129, 0.25);
            }
        }

        .header-title {
            font-size: 1.08rem;
            font-weight: 600;
            color: #f9fafb;
        }

        .header-subtitle {
            font-size: 0.78rem;
            color: #9ca3af;
        }

        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(148, 163, 184, 0.55), transparent);
            margin: 10px 0 16px;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            animation: formFade 0.5s ease-out;
        }

        @keyframes formFade {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .field-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        label {
            font-size: 0.8rem;
            color: #cbd5f5;
        }

        input, select, textarea {
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.45);
            padding: 9px 11px;
            font-size: 0.86rem;
            outline: none;
            background: rgba(15, 23, 42, 0.9);
            color: #e5e7eb;
            transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.18s ease;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #38bdf8;
            box-shadow:
                0 0 0 1px rgba(56, 189, 248, 0.65),
                0 12px 25px rgba(15, 23, 42, 0.9);
            transform: translateY(-1px);
        }

        textarea {
            resize: none;
            min-height: 60px;
        }

        .optional {
            font-size: 0.72rem;
            color: #9ca3af;
        }

        .button-container {
            margin-top: 8px;
        }

        button {
            width: 100%;
            border: none;
            border-radius: 999px;
            padding: 10px 16px;
            font-size: 0.92rem;
            font-weight: 600;
            letter-spacing: 0.02em;
            cursor: pointer;
            color: white;
            background: linear-gradient(135deg, #22c55e, #16a34a, #14b8a6);
            box-shadow:
                0 12px 26px rgba(5, 150, 105, 0.55),
                0 0 0 1px rgba(34, 197, 94, 0.35);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            transition:
                transform 0.16s ease,
                box-shadow 0.18s ease,
                filter 0.2s ease,
                background-position 0.4s ease;
            background-size: 180% 180%;
            animation: gradientMove 7s ease infinite;
        }

        @keyframes gradientMove {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -20%;
            width: 40%;
            height: 200%;
            background: linear-gradient(120deg, rgba(255, 255, 255, 0.7), transparent);
            transform: translateX(-120%) skewX(-18deg);
            opacity: 0;
        }

        button:hover::after {
            animation: shine 0.8s forwards;
        }

        @keyframes shine {
            from {
                transform: translateX(-120%) skewX(-18deg);
                opacity: 0;
            }
            to {
                transform: translateX(220%) skewX(-18deg);
                opacity: 1;
            }
        }

        button:hover {
            transform: translateY(-1px) scale(1.01);
            box-shadow:
                0 16px 34px rgba(5, 150, 105, 0.6),
                0 0 0 1px rgba(45, 212, 191, 0.25);
            filter: brightness(1.02);
        }

        button:active {
            transform: translateY(0) scale(0.99);
            box-shadow:
                0 10px 18px rgba(5, 150, 105, 0.5),
                0 0 0 1px rgba(22, 163, 74, 0.7);
            filter: brightness(0.96);
        }

        .btn-icon {
            font-size: 1rem;
        }

        .info-text {
            margin-top: 10px;
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .highlight {
            color: #22c55e;
            font-weight: 500;
        }

        .status-message {
            margin-top: 18px;
            padding: 10px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            line-height: 1.4;
            display: none;
        }

        .status-success {
            background: rgba(22, 163, 74, 0.16);
            border: 1px solid rgba(34, 197, 94, 0.45);
            color: #bbf7d0;
        }

        .status-error {
            background: rgba(185, 28, 28, 0.16);
            border: 1px solid rgba(248, 113, 113, 0.5);
            color: #fecaca;
        }

        .status-message.show {
            display: block;
            animation: statusEnter 0.4s ease-out;
        }

        @keyframes statusEnter {
            from {
                opacity: 0;
                transform: translateY(6px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Tela de ‚Äúaguarde ser chamado‚Äù */
        .overlay-aguarde {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top, rgba(34, 197, 94, 0.08), rgba(15, 23, 42, 0.98));
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 50;
        }

        .overlay-aguarde.active {
            display: flex;
            animation: overlayFade 0.4s ease-out;
        }

        @keyframes overlayFade {
            from {
                opacity: 0;
                transform: scale(1.02);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .aguarde-card {
            max-width: 420px;
            width: 100%;
            background: rgba(15, 23, 42, 0.96);
            border-radius: 22px;
            padding: 26px 20px 22px;
            text-align: center;
            color: #e5e7eb;
            box-shadow:
                0 22px 48px rgba(15, 23, 42, 0.94),
                0 0 0 1px rgba(148, 163, 184, 0.3);
            position: relative;
            overflow: hidden;
        }

        .aguarde-card::before {
            content: '';
            position: absolute;
            inset: -30%;
            background:
                conic-gradient(from 180deg at 50% 0%, rgba(34, 197, 94, 0.22), transparent 30%, transparent 70%, rgba(56, 189, 248, 0.18));
            opacity: 0.8;
            mix-blend-mode: soft-light;
            animation: rotateGlow 18s linear infinite;
        }

        @keyframes rotateGlow {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .aguarde-inner {
            position: relative;
            z-index: 1;
        }

        .aguarde-icon {
            width: 62px;
            height: 62px;
            border-radius: 999px;
            border: 2px solid rgba(52, 211, 153, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            color: #6ee7b7;
            font-size: 1.6rem;
            box-shadow:
                0 0 24px rgba(16, 185, 129, 0.55),
                0 0 0 1px rgba(45, 212, 191, 0.5);
            animation: pulseRing 2s ease-in-out infinite;
        }

        @keyframes pulseRing {
            0%, 100% {
                transform: scale(1);
                box-shadow:
                    0 0 18px rgba(16, 185, 129, 0.7),
                    0 0 0 1px rgba(45, 212, 191, 0.55);
            }
            50% {
                transform: scale(1.06);
                box-shadow:
                    0 0 34px rgba(16, 185, 129, 0.9),
                    0 0 0 1px rgba(45, 212, 191, 0.85);
            }
        }

        .aguarde-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #f9fafb;
            margin-bottom: 6px;
        }

        .aguarde-text {
            font-size: 0.86rem;
            color: #d1d5db;
        }

        .aguarde-name {
            margin-top: 12px;
            font-size: 0.88rem;
            color: #a5b4fc;
        }

        .aguarde-pisca {
            margin-top: 14px;
            font-size: 0.78rem;
            color: #9ca3af;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .dot {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: #22c55e;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.9);
            animation: blink 1.1s infinite ease-in-out;
        }

        @keyframes blink {
            0%, 100% {
                opacity: 0.2;
                transform: scale(0.9);
            }
            50% {
                opacity: 1;
                transform: scale(1.08);
            }
        }

        .hint-text {
            margin-top: 12px;
            font-size: 0.75rem;
            color: #6b7280;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px 16px 16px;
                border-radius: 16px;
            }

            .aguarde-card {
                border-radius: 18px;
                padding: 22px 16px 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="form-container">
        <div class="header">
            <div class="header-icon">üé´</div>
            <div>
                <div class="header-title">Gerar senha de atendimento</div>
                <div class="header-subtitle">Preencha seus dados para entrar na fila de atendimento.</div>
            </div>
        </div>

        <div class="divider"></div>

        <form id="senhaForm">
            <div class="field-group">
                <label for="nome">Nome completo</label>
                <input type="text" id="nome" required placeholder="Digite seu nome completo">
            </div>

            <div class="field-group">
                <label for="matricula">Matr√≠cula</label>
                <input type="text" id="matricula" required placeholder="Informe sua matr√≠cula">
            </div>

            <div class="field-group">
                <label for="curso">Curso</label>
                <input type="text" id="curso" required placeholder="Informe seu curso (ex: Teologia)">
            </div>

            <div class="field-group">
                <label for="responsavel">Respons√°vel (se menor de idade) <span class="optional">(opcional)</span></label>
                <input type="text" id="responsavel" placeholder="Nome do respons√°vel, se houver">
            </div>

            <div class="field-group">
                <label for="motivo">Motivo do atendimento <span class="optional">(opcional)</span></label>
                <textarea id="motivo" placeholder="Descreva brevemente o motivo do atendimento"></textarea>
            </div>

            <div class="button-container">
                <button type="submit" id="btnGerar">
                    <span class="btn-icon">‚úÖ</span>
                    <span>Confirmar e Gerar Senha</span>
                </button>
            </div>
        </form>

        <div class="info-text">
            Sua <span class="highlight">senha ser√° exibida no painel do atendente</span> e voc√™ ser√° chamado pelo nome.
        </div>

        <div id="statusMessage" class="status-message"></div>
    </div>

    <!-- Tela "aguarde ser chamado" -->
    <div class="overlay-aguarde" id="overlayAguarde">
        <div class="aguarde-card">
            <div class="aguarde-inner">
                <div class="aguarde-icon">‚è≥</div>
                <div class="aguarde-title">Sua senha foi gerada!</div>
                <div class="aguarde-text">
                    Aguarde, por favor. Seu nome ser√° chamado pelo respons√°vel no painel de atendimento.
                </div>
                <div id="aguardeNome" class="aguarde-name"></div>
                <div class="aguarde-pisca">
                    <span class="dot"></span>
                    <span>Aguardando chamada no painel...</span>
                </div>
                <div class="hint-text">
                    Caso precise sair, mantenha-se atento ao chamado do seu nome pela equipe.
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // TODO: substitua com a sua config real
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_AUTH_DOMAIN",
            databaseURL: "SUA_DATABASE_URL",
            projectId: "SEU_PROJECT_ID",
            storageBucket: "SEU_BUCKET",
            messagingSenderId: "SEU_SENDER_ID",
            appId: "SEU_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const form = document.getElementById('senhaForm');
        const statusMessage = document.getElementById('statusMessage');
        const overlayAguarde = document.getElementById('overlayAguarde');
        const aguardeNome = document.getElementById('aguardeNome');
        const btnGerar = document.getElementById('btnGerar');

        function mostrarStatus(texto, tipo = 'success') {
            statusMessage.textContent = texto;
            statusMessage.classList.remove('status-success', 'status-error', 'show');
            if (tipo === 'success') {
                statusMessage.classList.add('status-success');
            } else {
                statusMessage.classList.add('status-error');
            }
            requestAnimationFrame(() => {
                statusMessage.classList.add('show');
            });
        }

        form.addEventListener('submit', function (e) {
            e.preventDefault();

            const nome = document.getElementById('nome').value.trim();
            const matricula = document.getElementById('matricula').value.trim();
            const curso = document.getElementById('curso').value.trim();
            const responsavel = document.getElementById('responsavel').value.trim();
            const motivo = document.getElementById('motivo').value.trim();

            if (!nome || !matricula || !curso) {
                mostrarStatus('Preencha os campos obrigat√≥rios (nome, matr√≠cula e curso).', 'error');
                return;
            }

            btnGerar.disabled = true;
            btnGerar.style.filter = 'grayscale(0.3) brightness(0.85)';
            btnGerar.style.cursor = 'wait';

            const senha = 'A' + Date.now().toString().slice(-4);

            const dados = {
                senha,
                nome,
                matricula,
                curso,
                responsavel: responsavel || '',
                motivo: motivo || '',
                status: 'aguardando',
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            const filaRef = database.ref('filaSenhas').push();
            filaRef.set(dados)
                .then(() => {
                    // marca essa senha como pr√≥xima
                    return database.ref('proximaSenha').set({
                        id: filaRef.key,
                        senha: dados.senha
                    });
                })
                .then(() => {
                    mostrarStatus('Senha gerada com sucesso! Aguarde ser chamado.', 'success');
                    // mostra tela de aguarde
                    aguardeNome.textContent = nome ? `Aluno: ${nome}` : '';
                    overlayAguarde.classList.add('active');
                    // limpa apenas campos opcionais
                    document.getElementById('responsavel').value = '';
                    document.getElementById('motivo').value = '';
                })
                .catch((err) => {
                    console.error(err);
                    mostrarStatus('Ocorreu um erro ao gerar sua senha. Tente novamente.', 'error');
                })
                .finally(() => {
                    btnGerar.disabled = false;
                    btnGerar.style.filter = '';
                    btnGerar.style.cursor = 'pointer';
                });
        });
    </script>
</body>
</html>
